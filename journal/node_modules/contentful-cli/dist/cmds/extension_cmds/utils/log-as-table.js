'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.logExtension = logExtension;

var _cliTable = require('cli-table3');

var _cliTable2 = _interopRequireDefault(_cliTable);

var _lodash = require('lodash');

var _convertFieldType = require('./convert-field-type');

var _log = require('../../../utils/log');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function logExtension({ sys, extension, parameters }, spaceId, environmentId = 'master') {
  const table = new _cliTable2.default({
    head: ['Property', 'Value']
  });

  table.push(['ID', sys.id]);
  table.push(['Name', extension.name]);
  if ((0, _lodash.isArray)(extension.fieldTypes)) {
    table.push(['Field types', extension.fieldTypes.map(_convertFieldType.getDisplayName).join(', ')]);
  }
  table.push(['Src', extension.src || '[uses srcdoc]']);
  table.push(['Version', sys.version]);

  if (extension.sidebar) {
    table.push(['Sidebar', true]);
  }

  const instanceDefinitions = (0, _lodash.get)(extension, ['parameters', 'instance']) || [];
  const installationDefinitions = (0, _lodash.get)(extension, ['parameters', 'installation']) || [];
  const installationValues = parameters || {};

  table.push(['Parameter definitions', `Instance: ${instanceDefinitions.length}\nInstallation: ${installationDefinitions.length}`]);

  table.push(['Installation parameter values', `${Object.keys(installationValues).length}`]);

  const url = ['https://app.contentful.com/spaces/', `${spaceId}/`, environmentId !== 'master' ? `environments/${environmentId}/` : '', 'settings/extensions/', sys.id].join('');

  (0, _log.log)(`Space: ${spaceId}\n`);
  (0, _log.log)(`Environment: ${environmentId}\n`);
  (0, _log.log)(`Your extension: ${url}\n`);

  (0, _log.log)(table.toString());
}