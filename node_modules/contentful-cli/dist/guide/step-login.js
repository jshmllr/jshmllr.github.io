'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _login = require('../cmds/login');

var _context = require('../context');

var _log = require('../utils/log');

var _text = require('../utils/text');

var _styles = require('../utils/styles');

var _emojis = require('../utils/emojis');

var _helpers = require('./helpers');

exports.default = async function loginStep(guideContext) {
  const context = await (0, _context.getContext)();
  const { managementToken } = context;

  if (!managementToken) {
    guideContext.stepCount++;

    const { stepCount } = guideContext;

    (0, _log.log)((0, _text.separator)(_helpers.GUIDE_MAX_WIDTH));
    (0, _log.wrappedLog)(`${(0, _emojis.generateNumberEmoji)(stepCount)} Sign in to a new or existing account`, _helpers.GUIDE_MAX_WIDTH);
    (0, _log.log)((0, _text.separator)(_helpers.GUIDE_MAX_WIDTH));
    (0, _log.log)();
    (0, _log.wrappedLog)(`First, we’ll store your access token (CMA token) on your machine in order for the CLI to authenticate write requests against the ${(0, _styles.highlightStyle)('Content Management API')}.`, _helpers.GUIDE_MAX_WIDTH);
    (0, _log.log)();
    (0, _log.wrappedLog)(`We’ll run the ${(0, _styles.codeStyle)('contentful login')} command which will open a new browser window. In the browser, you’ll find your ${(0, _styles.highlightStyle)('CMA token')}. Copy/paste your ${(0, _styles.highlightStyle)('CMA token')} to authenticate.`, _helpers.GUIDE_MAX_WIDTH);
    (0, _log.log)();

    await (0, _login.login)({ context });
  }
};