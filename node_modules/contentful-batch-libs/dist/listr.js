'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.wrapTask = wrapTask;

var _logging = require('./logging');

// Set up log emitter listening from SDK, proper error catching and throwing of SDK errors
function wrapTask(func) {
  return function (ctx, task) {
    var teardownTaskListeners = (0, _logging.logToTaskOutput)(task);
    return func(ctx, task).then(function () {
      teardownTaskListeners();
    }).catch(function (error) {
      teardownTaskListeners();
      // Format message as human readable listr output
      var formattedMessage = (0, _logging.formatLogMessageOneLine)({
        ts: new Date().toJSON(),
        level: 'error',
        error
      });
      var enrichedError = new Error(formattedMessage);

      // Attach original error object for error log
      enrichedError.originalError = error;
      throw enrichedError;
    });
  };
}